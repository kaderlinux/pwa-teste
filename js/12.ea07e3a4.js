(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{"7fc5":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",[a("desktop")],1)},i=[],o={components:{desktop:a("e493").default}},n=o,r=a("2877"),l=a("9989"),c=a("eebe"),d=a.n(c),u=Object(r["a"])(n,s,i,!1,null,null,null);t["default"]=u.exports;d()(u,"components",{QPage:l["a"]})},e493:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{attrs:{padding:""}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col"},[a("q-table",{attrs:{data:e.data,columns:e.columns,"row-key":"_id",pagination:e.pagination,loading:e.loading,filter:e.filter,"binary-state-sort":"","rows-per-page-options":[10],"visible-columns":e.visibleColumns},on:{"update:pagination":function(t){e.pagination=t},request:e.onRequest},scopedSlots:e._u([{key:"top",fn:function(t){return[a("span",{staticClass:"text-h5"},[e._v("Messagerie\n            "),a("span",{staticClass:"text-caption"},[e._v("("+e._s(e.pagination.rowsNumber)+")")])]),"MADR"==e.user.typeCompte?a("select-wilaya"):e._e(),e.wilaya?a("select-commune"):e._e(),a("q-space"),a("q-btn",{staticClass:"col-auto q-mr-md",attrs:{color:"grey-3","text-color":"blue-grey",unelevated:"",icon:"email",label:"Nouveau message"},on:{click:function(t){e.addDialog=!0}}}),a("q-btn",{staticClass:"col-auto",attrs:{color:"grey-3","text-color":"blue-grey",unelevated:"",icon:"refresh",label:"Actualiser"},on:{click:e.refresh}})]}},{key:"body",fn:function(t){return[a("q-tr",{attrs:{props:t}},[a("q-td",{key:"id",attrs:{props:t}},[e._v(e._s(t.rowIndex+1))]),a("q-td",{key:"message",attrs:{props:t}},[e._v(e._s(t.row.message.length>80?t.row.message.substring(0,80)+"...":t.row.message))]),a("q-td",{key:"commune",attrs:{props:t}},[e._v(e._s(t.row.commune.commune_name?t.row.commune.commune_name:""))]),a("q-td",{key:"wilaya",attrs:{props:t}},[e._v(e._s(t.row.commune.wilaya_name?t.row.commune.wilaya_name:""))]),a("q-td",{key:"created_at_frm",attrs:{props:t}},[e._v(e._s(t.row.created_at_frm?t.row.created_at_frm:""))]),a("q-td",{key:"resolu",attrs:{props:t}},[a("q-icon",{attrs:{name:"check_circle",color:t.row.resolu?"blue-grey-3":"transparent",size:"sm"}})],1),a("q-td",{key:"edit",attrs:{props:t}},[a("q-btn",{staticClass:"q-mr-md",attrs:{color:"accent",size:"13px",flat:"",dense:"",round:"",icon:"visibility"},on:{click:function(a){return e.showMessagerie(t.row)}}}),a("q-btn",{staticClass:"q-mr-md",attrs:{color:"negative",size:"13px",flat:"",dense:"",round:"",icon:"delete"},on:{click:function(a){return e.deleteMessagerie(t.row)}}})],1)],1)]}}])})],1)]),a("q-dialog",{model:{value:e.addDialog,callback:function(t){e.addDialog=t},expression:"addDialog"}},[a("messagerieAdd",{on:{close:e.itemAdded}})],1),a("q-dialog",{model:{value:e.updateDialog,callback:function(t){e.updateDialog=t},expression:"updateDialog"}},[a("messagerieUpdate",{on:{close:function(t){e.updateDialog=!1}}})],1),a("q-dialog",{model:{value:e.showDialog,callback:function(t){e.showDialog=t},expression:"showDialog"}},[a("messagerieShow",{on:{close:function(t){e.showDialog=!1}}})],1)],1)},i=[],o=(a("ddb0"),{name:"PagePage1",computed:{messageries:function(){return this.$store.getters["messagerie/messageries"]},wilaya:function(){return this.$store.getters["fiche/wilaya"]},commune:function(){return this.$store.getters["fiche/commune"]},user:function(){return this.$store.getters["auth/user"]},messagerie_validation(){return"rga_validation"==this.db}},watch:{total_rows:function(e){this.pagination.rowsNumber=e},wilaya:function(e){this.refresh()},commune:function(e){this.refresh()}},data(){return{filter:"",loading:!1,pagination:{sortBy:"desc",descending:!1,page:1,rowsPerPage:10,rowsNumber:0},addDialog:!1,updateDialog:!1,showDialog:!1,data:[],visibleColumns:["id","message","commune","created_at_frm","resolu","edit"],columns:[{name:"id",field:"id",label:"id",align:"left",sortable:!1},{name:"message",field:"message",label:"Message",align:"left",sortable:!1},{name:"commune",field:"commune.commune_name",label:"Commune",align:"left",sortable:!1},{name:"created_at_frm",field:"created_at_frm",label:"Date Création",align:"center",sortable:!1},{name:"resolu",field:"resolu",label:"Problème résolu",align:"center",sortable:!1},{name:"edit",label:"",align:"right"}]}},components:{"select-wilaya":a("0b56").default,"select-commune":a("2112").default,messagerieAdd:a("9ca0").default,messagerieUpdate:a("9609").default,messagerieShow:a("18e4").default},methods:{editMessagerie(e){this.$store.dispatch("messagerie/setCurrentMessagerie",e),this.updateDialog=!0},showMessagerie(e){this.$store.dispatch("messagerie/setCurrentMessagerie",e),this.showDialog=!0},deleteMessagerie(e){this.$q.dialog({name:"Supprission",message:"Voulez vous supprimer ?",cancel:!0,persistent:!0}).onOk(()=>{this.$store.dispatch("messagerie/deleteMessagerie",e).then(()=>{this.refresh()})}).onCancel(()=>{console.log(">>>> Cancel")})},itemAdded(){this.addDialog=!1,this.$q.notify({message:"Message Envoyé avec succès !",type:"positive"}),this.refresh()},refresh(){this.onRequest({pagination:this.pagination})},onRequest(e){const{page:t,rowsPerPage:a,sortBy:s,descending:i}=e.pagination;this.loading=!0,this.$store.dispatch("messagerie/getRowsNumber",{wilaya:this.wilaya,commune:this.commune}).then(e=>{this.pagination.rowsNumber=e,setTimeout(()=>{const e=(t-1)*a;this.$store.dispatch("messagerie/getMessageries",{filter:this.filter,skip:e,wilaya:this.wilaya,commune:this.commune}).then(e=>{this.data.splice(0,this.data.length,...this.messageries),this.pagination.page=t,this.pagination.rowsPerPage=a,this.pagination.sortBy=s,this.pagination.descending=i,this.loading=!1})},100)})}},mounted(){this.onRequest({pagination:this.pagination})}}),n=o,r=a("2877"),l=a("9989"),c=a("eaac"),d=a("2c91"),u=a("9c40"),m=a("bd08"),g=a("db86"),p=a("0016"),h=a("24e8"),f=a("eebe"),w=a.n(f),b=Object(r["a"])(n,s,i,!1,null,null,null);t["default"]=b.exports;w()(b,"components",{QPage:l["a"],QTable:c["a"],QSpace:d["a"],QBtn:u["a"],QTr:m["a"],QTd:g["a"],QIcon:p["a"],QDialog:h["a"]})}}]);